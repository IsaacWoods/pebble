<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This module contains constants that define how the kernel address space is laid out on RISC-V using the Sv48 paging model. It is very similar to the layout on `x86_64`, as the structure of the page tables are almost identical on the two architectures."><title>hal_riscv::platform_virt::kernel_map - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-dd39b87e5fcfba68.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="hal_riscv" data-themes="" data-resource-suffix="" data-rustdoc-version="1.80.0-nightly (b92758a9a 2024-05-20)" data-channel="nightly" data-search-js="search-d52510db62a78183.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../hal_riscv/index.html">hal_riscv</a><span class="version">0.1.0</span></h2></div><h2 class="location"><a href="#">Module kernel_map</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#constants">Constants</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In hal_riscv::platform_virt</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">hal_riscv</a>::<wbr><a href="../index.html">platform_virt</a>::<wbr><a class="mod" href="#">kernel_map</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../../src/hal_riscv/platform_virt.rs.html#35">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This module contains constants that define how the kernel address space is laid out on RISC-V
using the Sv48 paging model. It is very similar to the layout on <code>x86_64</code>, as the structure of
the page tables are almost identical on the two architectures.</p>
<p>The 511th P4 entry (virtual addresses <code>0xffff_ff80_0000_0000</code> through <code>0xffff_ffff_ffff_ffff</code>)
is always mapped to the kernel P3. The rest of the virtual address space (virtual addresses
<code>0x0000_0000_0000_0000</code> through <code>0xffff_ff7f_ffff_ffff</code>) are free for userspace to use.</p>
<p>This gives us 512 GiB of kernel space. The kernel itself lies within the top 2GiB of the
address space (the top two entries of the kernel P3). The remaining 510 GiB of the kernel P3 is
used to map the entirety of physical memory into the kernel address space, and for task kernel
stacks.</p>
<p>Directly below the base of the kernel, we reserve 128GiB for task kernel stacks, which gives us
a maximum of
65536 tasks if each one has the default stack size.</p>
<p>This leaves us 382GiB for the physical memory map, which should be sufficient for any system I
can imagine us running on (famous last words).</p>
</div></details><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.KERNEL_ADDRESS_SPACE_START.html" title="constant hal_riscv::platform_virt::kernel_map::KERNEL_ADDRESS_SPACE_START">KERNEL_ADDRESS_SPACE_START</a></div></li><li><div class="item-name"><a class="constant" href="constant.KERNEL_BASE.html" title="constant hal_riscv::platform_virt::kernel_map::KERNEL_BASE">KERNEL_BASE</a></div><div class="desc docblock-short">The kernel starts at -2GiB. The kernel image is loaded directly at this address, and the following space until
the top of memory is managed dynamically and contains the boot info structures, memory map, and kernel heap.</div></li><li><div class="item-name"><a class="constant" href="constant.KERNEL_P4_ENTRY.html" title="constant hal_riscv::platform_virt::kernel_map::KERNEL_P4_ENTRY">KERNEL_P4_ENTRY</a></div></li><li><div class="item-name"><a class="constant" href="constant.KERNEL_STACKS_BASE.html" title="constant hal_riscv::platform_virt::kernel_map::KERNEL_STACKS_BASE">KERNEL_STACKS_BASE</a></div></li><li><div class="item-name"><a class="constant" href="constant.MAX_TASKS.html" title="constant hal_riscv::platform_virt::kernel_map::MAX_TASKS">MAX_TASKS</a></div></li><li><div class="item-name"><a class="constant" href="constant.PHYSICAL_MAP_BASE.html" title="constant hal_riscv::platform_virt::kernel_map::PHYSICAL_MAP_BASE">PHYSICAL_MAP_BASE</a></div></li><li><div class="item-name"><a class="constant" href="constant.STACK_SLOT_SIZE.html" title="constant hal_riscv::platform_virt::kernel_map::STACK_SLOT_SIZE">STACK_SLOT_SIZE</a></div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.physical_to_virtual.html" title="fn hal_riscv::platform_virt::kernel_map::physical_to_virtual">physical_to_virtual</a></div><div class="desc docblock-short">Access a given physical address through the physical mapping. This cannot be used until the kernel page tables
have been switched to.</div></li></ul></section></div></main></body></html>