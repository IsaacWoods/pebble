<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="maitake-sync"><title>maitake_sync - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="maitake_sync" data-themes="" data-resource-suffix="" data-rustdoc-version="1.85.0-nightly (0aeaa5eb2 2024-12-14)" data-channel="nightly" data-search-js="search-92e6798f.js" data-settings-js="settings-0f613d39.js" ><script src="../static.files/storage-59e33391.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-044be391.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../maitake_sync/index.html">maitake_<wbr>sync</a><span class="version">0.1.0</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section id="rustdoc-toc"><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#maitake-sync" title="maitake-sync">maitake-sync</a><ul><li><a href="#what-is-it" title="what is it?">what is it?</a></li><li><a href="#a-tour-of-maitake-sync" title="a tour of `maitake-sync`">a tour of <code>maitake-sync</code></a></li><li><a href="#usage-considerations" title="usage considerations">usage considerations</a></li><li><a href="#features" title="features">features</a></li></ul></li></ul><h3><a href="#modules">Crate Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <span>maitake_sync</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/maitake_sync/lib.rs.html#1-75">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="maitake-sync"><a class="doc-anchor" href="#maitake-sync">¬ß</a>maitake-sync</h2>
<p>üé∂üçÑ <a href="https://en.wikipedia.org/wiki/Grifola_frondosa">‚ÄúDancing mushroom‚Äù</a> ‚Äî asynchronous synchronization
primitives from <a href="https://mycelium.elizas.website/maitake"><code>maitake</code></a></p>
<p><a href="https://crates.io/crates/maitake-sync-sync"><img src="https://img.shields.io/crates/v/maitake-sync.svg" alt="crates.io" /></a>
<a href="https://docs.rs/maitake-sync"><img src="https://docs.rs/maitake-sync/badge.svg" alt="Documentation" /></a>
<a href="https://mycelium.elizas.website/maitake-sync"><img src="https://img.shields.io/netlify/3ec00bb5-251a-4f83-ac7f-3799d95db0e6?label=docs%20%28main%20branch%29" alt="Documentation (HEAD)" /></a>
<a href="../LICENSE"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="MIT licensed" /></a>
<a href="https://github.com/hawkw/mycelium/actions/workflows/ci.yml"><img src="https://github.com/hawkw/mycelium/actions/workflows/ci.yml/badge.svg?branch=main" alt="Test Status" /></a>
<a href="https://github.com/sponsors/hawkw"><img src="https://img.shields.io/badge/sponsor-%F0%9F%A4%8D-ff69b4" alt="Sponsor @hawkw on GitHub Sponsors" /></a></p>
<h3 id="what-is-it"><a class="doc-anchor" href="#what-is-it">¬ß</a>what is it?</h3>
<p>This library is a collection of synchronization primitives for asynchronous Rust
software based on <a href="https://doc.rust-lang.org/stable/core/task/index.html"><code>core::task</code></a> and <a href="https://doc.rust-lang.org/stable/core/future/index.html"><code>core::future</code></a>, with a focus on
supporting <code>#![no_std]</code> projects. It was initially developed as part of
<a href="https://mycelium.elizas.website/maitake"><code>maitake</code></a>, an ‚Äúasync runtime construction kit‚Äù intended for use in the
<a href="https://github.com/hawkw/mycelium">mycelium</a> and <a href="https://mnemos.dev">mnemOS</a> operating systems, but it may be useful for other
projects as well.</p>
<p>To learn a bit of the backstory behind <code>maitake-sync</code>, see the <a href="https://www.elizas.website/announcing-maitake-sync.html">announcement
post</a>!</p>
<blockquote>
<p><strong>Note</strong></p>
<p>This is a hobby project. I‚Äôm working on it in my spare time, for my own
personal use. I‚Äôm very happy to share it with the broader Rust community, and
<a href="https://github.com/hawkw/mycelium/compare">contributions</a> and <a href="https://github.com/hawkw/mycelium/issues/new">bug reports</a> are always welcome. However, please remember
that I‚Äôm working on this library <em>for fun</em>, and if it stops being fun‚Ä¶well,
you get the idea.</p>
<p>Anyway, feel free to use and enjoy this crate, and to contribute back as much
as you want to!</p>
</blockquote>
<p><a href="https://wiki.osdev.org/Synchronization_Primitives"><em>Synchronization primitives</em></a> are tools for implementing
synchronization between <a href="https://doc.rust-lang.org/stable/core/task/index.html">tasks</a>: to control which tasks can run at
any given time, and in what order, and to coordinate tasks‚Äô access to shared
resources. Typically, this synchronization involves some form of <em>waiting</em>. In
asynchronous systems, synchronization primitives allow tasks to wait by yielding
to the runtime scheduler, so that other tasks may run while they are waiting.</p>
<h3 id="a-tour-of-maitake-sync"><a class="doc-anchor" href="#a-tour-of-maitake-sync">¬ß</a>a tour of <code>maitake-sync</code></h3>
<p>The following synchronization primitives are provided:</p>
<ul>
<li><a href="https://docs.rs/maitake-sync/latest/maitake_sync/struct.Mutex.html"><code>Mutex</code></a>: a fairly queued, asynchronous <a href="https://en.wikipedia.org/wiki/Mutual_exclusion">mutual exclusion lock</a>, for
protecting shared data</li>
<li><a href="https://docs.rs/maitake-sync/latest/maitake_sync/struct.RwLock.html"><code>RwLock</code></a>: a fairly queued, asynchronous <a href="https://en.wikipedia.org/wiki/Readers%E2%80%93writer_lock">readers-writer lock</a>, which
allows concurrent read access to shared data while ensuring write
access is exclusive</li>
<li><a href="https://docs.rs/maitake-sync/latest/maitake_sync/struct.Semaphore.html"><code>Semaphore</code></a>: an asynchronous <a href="https://en.wikipedia.org/wiki/Semaphore_(programming)">counting semaphore</a>, for limiting the
number of tasks which may run concurrently</li>
<li><a href="https://docs.rs/maitake-sync/latest/maitake_sync/struct.WaitCell.html"><code>WaitCell</code></a>, a cell that stores a <em>single</em> waiting task‚Äôs <a href="https://doc.rust-lang.org/nightly/core/task/wake/struct.Waker.html" title="struct core::task::wake::Waker"><code>Waker</code></a>, so
that the task can be woken by another task,</li>
<li><a href="https://docs.rs/maitake-sync/latest/maitake_sync/struct.WaitQueue.html"><code>WaitQueue</code></a>, a queue of waiting tasks, which are woken in first-in,
first-out order</li>
<li><a href="https://docs.rs/maitake-sync/latest/maitake_sync/struct.WaitMap.html"><code>WaitMap</code></a>, a set of waiting tasks associated with keys, in which a task
can be woken by its key</li>
</ul>
<p>In addition, the <a href="https://docs.rs/maitake-sync/latest/maitake_sync/util/index.html"><code>util</code> module</a> contains a collection of general-purpose
utilities for implementing synchronization primitives, and the <a href="https://docs.rs/maitake-sync/latest/maitake_sync/spin/index.html"><code>spin</code> module</a>
contains implementations of <em>non-async</em>, spinning-based synchronization
primitives.</p>
<h3 id="usage-considerations"><a class="doc-anchor" href="#usage-considerations">¬ß</a>usage considerations</h3>
<p><code>maitake-sync</code> is intended primarily for use in bare-metal projects, such as
operating systems, operating system components, and embedded systems. These
bare-metal systems typically do not use the Rust standard library, so
<code>maitake-sync</code> supports <code>#![no_std]</code> by default, and the use of <a href="https://doc.rust-lang.org/alloc/"><code>liballoc</code></a> is
feature-flagged for systems where <a href="https://doc.rust-lang.org/alloc/"><code>liballoc</code></a> is unavailable.</p>
<h4 id="support-for-atomic-operations"><a class="doc-anchor" href="#support-for-atomic-operations">¬ß</a>support for atomic operations</h4>
<p>In general, <code>maitake-sync</code> is a platform-agnostic library. It does not interact
directly with the underlying hardware, or use platform-specific features.
However, one aspect of <code>maitake-sync</code>‚Äôs implementation may differ slightly
across different target architectures: <code>maitake-sync</code> relies on atomic
operations integers. Sometimes, atomic operations on integers of specific widths
are needed (e.g., <a href="https://doc.rust-lang.org/stable/core/sync/atomic/struct.AtomicU64.html"><code>AtomicU64</code></a>), which may not be available on all architectures.</p>
<p>In order to work on architectures which lack atomic operations on 64-bit
integers, <code>maitake-sync</code> uses the <a href="https://crates.io/crates/portable-atomic"><code>portable-atomic</code></a> crate by Taiki Endo. This
crate crate polyfills atomic operations on integers larger than the platform‚Äôs
pointer width, when these are not supported in hardware.</p>
<p>In most cases, users of <code>maitake-sync</code> don‚Äôt need to be aware of <code>maitake-sync</code>‚Äôs use of
<code>portable-atomic</code>. If compiling <code>maitake-sync</code> for a target architecture that has
native support for 64-bit atomic operations (such as <code>x86_64</code> or <code>aarch64</code>), the
native atomics are used automatically. Similarly, if compiling <code>maitake</code> for any
target that has atomic compare-and-swap operations on any size integer, but
lacks 64-bit atomics (i.e., 32-bit x86 targets like <code>i686</code>, or 32-bit ARM
targets with atomic operations), the <code>portable-atomic</code> polyfill is used
automatically. Finally, when compiling for target architectures which lack
atomic operations because they are <em>always</em> single-core, such as MSP430 or AVR
microcontrollers, <code>portable-atomic</code> simply uses unsynchronized operations with
interrupts temporarily disabled.</p>
<p><strong>The only case where the user must be aware of <code>portable-atomic</code> is when
compiling for targets which lack atomic operations but are not guaranteed to
always be single-core</strong>. This includes ARMv6-M (<code>thumbv6m</code>), pre-v6 ARM (e.g.,
<code>thumbv4t</code>, <code>thumbv5te</code>), and RISC-V targets without the A extension. On these
architectures, the user must manually enable the <a href="https://doc.rust-lang.org/cargo/reference/config.html#buildrustflags"><code>RUSTFLAGS</code></a> configuration
<a href="https://docs.rs/portable-atomic/latest/portable_atomic/#optional-cfg"><code>--cfg portable_atomic_unsafe_assume_single_core</code></a> if (and <strong>only
if</strong>) the specific target hardware is known to be single-core. Enabling this cfg
is unsafe, as it will cause unsound behavior on multi-core systems using these
architectures.</p>
<p>Additional configurations for some single-core systems, which determine the
specific sets of interrupts that <code>portable-atomic</code> will disable when entering a
critical section, are described <a href="https://github.com/taiki-e/portable-atomic/blob/HEAD/src/imp/interrupt/README.md">here</a>.</p>
<h3 id="features"><a class="doc-anchor" href="#features">¬ß</a>features</h3>
<p>The following features are available (this list is incomplete; you can help by <a href="https://github.com/hawkw/mycelium/edit/main/maitake-suync/README.md">expanding it</a>.)</p>
<div><table><thead><tr><th style="text-align: left">Feature</th><th style="text-align: left">Default</th><th style="text-align: left">Explanation</th></tr></thead><tbody>
<tr><td style="text-align: left"><code>alloc</code></td><td style="text-align: left"><code>true</code></td><td style="text-align: left">Enables <a href="https://doc.rust-lang.org/alloc/"><code>liballoc</code></a> dependency</td></tr>
<tr><td style="text-align: left"><code>no-cache-pad</code></td><td style="text-align: left"><code>false</code></td><td style="text-align: left">Inhibits cache padding for the <a href="https://docs.rs/maitake-sync/latest/maitake_sync/util/struct.CachePadded.html"><code>CachePadded</code></a> struct. When this feature is NOT enabled, the size will be determined based on target platform.</td></tr>
<tr><td style="text-align: left"><code>tracing</code></td><td style="text-align: left"><code>false</code></td><td style="text-align: left">Enables support for <a href="https://crates.io/crates/tracing"><code>tracing</code></a> diagnostics. Requires <code>liballoc</code>.</td></tr>
<tr><td style="text-align: left"><code>core-error</code></td><td style="text-align: left"><code>false</code></td><td style="text-align: left">Enables implementations of the <a href="https://doc.rust-lang.org/stable/core/error/index.html"><code>core::error::Error</code> trait</a> for <code>maitake-sync</code>‚Äôs error types. <em>Requires a nightly Rust toolchain</em>.</td></tr>
</tbody></table>
</div></div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">¬ß</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="mutex/index.html" title="mod maitake_sync::mutex">mutex</a></div><div class="desc docblock-short">An asynchronous <a href="https://en.wikipedia.org/wiki/Mutual_exclusion">mutual exclusion lock</a>.</div></li><li><div class="item-name"><a class="mod" href="rwlock/index.html" title="mod maitake_sync::rwlock">rwlock</a></div><div class="desc docblock-short">An asynchronous <a href="https://en.wikipedia.org/wiki/Readers%E2%80%93writer_lock">readers-writer lock</a>.</div></li><li><div class="item-name"><a class="mod" href="semaphore/index.html" title="mod maitake_sync::semaphore">semaphore</a></div><div class="desc docblock-short">An asynchronous <a href="https://en.wikipedia.org/wiki/Semaphore_(programming)">counting semaphore</a>.</div></li><li><div class="item-name"><a class="mod" href="spin/index.html" title="mod maitake_sync::spin">spin</a></div><div class="desc docblock-short">Synchronous spinning-based synchronization primitives.</div></li><li><div class="item-name"><a class="mod" href="util/index.html" title="mod maitake_sync::util">util</a></div><div class="desc docblock-short">Reusable utilities for synchronization primitives.</div></li><li><div class="item-name"><a class="mod" href="wait_cell/index.html" title="mod maitake_sync::wait_cell">wait_<wbr>cell</a></div><div class="desc docblock-short">An atomically registered <a href="https://doc.rust-lang.org/nightly/core/task/wake/struct.Waker.html" title="struct core::task::wake::Waker"><code>Waker</code></a>, for waking a single task.</div></li><li><div class="item-name"><a class="mod" href="wait_map/index.html" title="mod maitake_sync::wait_map">wait_<wbr>map</a></div><div class="desc docblock-short">A map of <a href="https://doc.rust-lang.org/nightly/core/task/wake/struct.Waker.html" title="struct core::task::wake::Waker"><code>Waker</code></a>s associated with keys, so that a task can be woken by
key.</div></li><li><div class="item-name"><a class="mod" href="wait_queue/index.html" title="mod maitake_sync::wait_queue">wait_<wbr>queue</a></div><div class="desc docblock-short">A queue of waiting tasks that can be woken in first-in, first-out order (or
all at once).</div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">¬ß</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Closed.html" title="struct maitake_sync::Closed">Closed</a></div><div class="desc docblock-short">An error indicating that a <a href="struct.WaitCell.html" title="struct maitake_sync::WaitCell"><code>WaitCell</code></a>, <a href="struct.WaitQueue.html" title="struct maitake_sync::WaitQueue"><code>WaitQueue</code></a> or <a href="struct.Semaphore.html" title="struct maitake_sync::Semaphore"><code>Semaphore</code></a> was
closed while attempting to register a waiting task.</div></li><li><div class="item-name"><a class="struct" href="struct.Mutex.html" title="struct maitake_sync::Mutex">Mutex</a></div><div class="desc docblock-short">An asynchronous <a href="https://en.wikipedia.org/wiki/Mutual_exclusion">mutual exclusion lock</a> for protecting shared data.</div></li><li><div class="item-name"><a class="struct" href="struct.MutexGuard.html" title="struct maitake_sync::MutexGuard">Mutex<wbr>Guard</a></div><div class="desc docblock-short">An <a href="https://rust-unofficial.github.io/patterns/patterns/behavioural/RAII.html">RAII</a> implementation of a ‚Äúscoped lock‚Äù of a <a href="struct.Mutex.html" title="struct maitake_sync::Mutex"><code>Mutex</code></a>. When this
structure is dropped (falls out of scope), the lock will be unlocked.</div></li><li><div class="item-name"><a class="struct" href="struct.OwnedMutexGuard.html" title="struct maitake_sync::OwnedMutexGuard">Owned<wbr>Mutex<wbr>Guard</a></div><div class="desc docblock-short">An <a href="https://rust-unofficial.github.io/patterns/patterns/behavioural/RAII.html">RAII</a> implementation of a ‚Äúscoped lock‚Äù of a <a href="struct.Mutex.html" title="struct maitake_sync::Mutex"><code>Mutex</code></a>. When this
structure is dropped (falls out of scope), the lock will be unlocked.</div></li><li><div class="item-name"><a class="struct" href="struct.OwnedRwLockReadGuard.html" title="struct maitake_sync::OwnedRwLockReadGuard">Owned<wbr>RwLock<wbr>Read<wbr>Guard</a></div><div class="desc docblock-short">Owned <a href="https://rust-unofficial.github.io/patterns/patterns/behavioural/RAII.html">RAII</a> structure used to release the shared read access of a
<a href="struct.RwLock.html" title="struct maitake_sync::RwLock"><code>RwLock</code></a> when dropped.</div></li><li><div class="item-name"><a class="struct" href="struct.OwnedRwLockWriteGuard.html" title="struct maitake_sync::OwnedRwLockWriteGuard">Owned<wbr>RwLock<wbr>Write<wbr>Guard</a></div><div class="desc docblock-short">Owned <a href="https://rust-unofficial.github.io/patterns/patterns/behavioural/RAII.html">RAII</a> structure used to release the exclusive write access of a
<a href="struct.RwLock.html" title="struct maitake_sync::RwLock"><code>RwLock</code></a> when dropped.</div></li><li><div class="item-name"><a class="struct" href="struct.RwLock.html" title="struct maitake_sync::RwLock">RwLock</a></div><div class="desc docblock-short">An asynchronous <a href="https://en.wikipedia.org/wiki/Readers%E2%80%93writer_lock">readers-writer lock</a>.</div></li><li><div class="item-name"><a class="struct" href="struct.RwLockReadGuard.html" title="struct maitake_sync::RwLockReadGuard">RwLock<wbr>Read<wbr>Guard</a></div><div class="desc docblock-short"><a href="https://rust-unofficial.github.io/patterns/patterns/behavioural/RAII.html">RAII</a> structure used to release the shared read access of a <a href="struct.RwLock.html" title="struct maitake_sync::RwLock"><code>RwLock</code></a> when
dropped.</div></li><li><div class="item-name"><a class="struct" href="struct.RwLockWriteGuard.html" title="struct maitake_sync::RwLockWriteGuard">RwLock<wbr>Write<wbr>Guard</a></div><div class="desc docblock-short"><a href="https://rust-unofficial.github.io/patterns/patterns/behavioural/RAII.html">RAII</a> structure used to release the exclusive write access of a <a href="struct.RwLock.html" title="struct maitake_sync::RwLock"><code>RwLock</code></a> when
dropped.</div></li><li><div class="item-name"><a class="struct" href="struct.Semaphore.html" title="struct maitake_sync::Semaphore">Semaphore</a></div><div class="desc docblock-short">An asynchronous <a href="https://en.wikipedia.org/wiki/Semaphore_(programming)">counting semaphore</a>.</div></li><li><div class="item-name"><a class="struct" href="struct.WaitCell.html" title="struct maitake_sync::WaitCell">Wait<wbr>Cell</a></div><div class="desc docblock-short">An atomically registered <a href="https://doc.rust-lang.org/nightly/core/task/wake/struct.Waker.html" title="struct core::task::wake::Waker"><code>Waker</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.WaitMap.html" title="struct maitake_sync::WaitMap">WaitMap</a></div><div class="desc docblock-short">A map of <a href="https://doc.rust-lang.org/nightly/core/task/wake/struct.Waker.html" title="struct core::task::wake::Waker"><code>Waker</code></a>s associated with keys, allowing tasks to be woken by
their key.</div></li><li><div class="item-name"><a class="struct" href="struct.WaitQueue.html" title="struct maitake_sync::WaitQueue">Wait<wbr>Queue</a></div><div class="desc docblock-short">A queue of waiting tasks which can be <a href="struct.WaitQueue.html#method.wake" title="method maitake_sync::WaitQueue::wake">woken in first-in, first-out
order</a>, or <a href="struct.WaitQueue.html#method.wake_all" title="method maitake_sync::WaitQueue::wake_all">all at once</a>.</div></li></ul><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">¬ß</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.WaitResult.html" title="type maitake_sync::WaitResult">Wait<wbr>Result</a></div><div class="desc docblock-short">The result of waiting on a <a href="struct.WaitQueue.html" title="struct maitake_sync::WaitQueue"><code>WaitQueue</code></a> or <a href="struct.Semaphore.html" title="struct maitake_sync::Semaphore"><code>Semaphore</code></a>.</div></li></ul></section></div></main></body></html>