<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `Platform` trait in crate `kernel`."><title>Platform in kernel - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-2c208a72533b4dd0.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="kernel" data-themes="" data-resource-suffix="" data-rustdoc-version="1.79.0-nightly (0bf471f33 2024-04-13)" data-channel="nightly" data-search-js="search-ffac13a0df2b1870.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-e32f0c247825364d.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-c97aec732c613ca4.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-09095024cf37855e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../kernel/index.html">kernel</a><span class="version">0.1.0</span></h2></div><h2 class="location"><a href="#">Platform</a></h2><div class="sidebar-elems"><section><h3><a href="#required-associated-types">Required Associated Types</a></h3><ul class="block"><li><a href="#associatedtype.PageTable">PageTable</a></li><li><a href="#associatedtype.PageTableSize">PageTableSize</a></li><li><a href="#associatedtype.TaskContext">TaskContext</a></li></ul><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.context_switch">context_switch</a></li><li><a href="#tymethod.drop_into_userspace">drop_into_userspace</a></li><li><a href="#tymethod.initialize_task_stacks">initialize_task_stacks</a></li><li><a href="#tymethod.kernel_page_table">kernel_page_table</a></li><li><a href="#tymethod.new_task_context">new_task_context</a></li><li><a href="#tymethod.switch_user_stack_pointer">switch_user_stack_pointer</a></li></ul><h3><a href="#object-safety">Object Safety</a></h3><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In crate kernel</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../kernel/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings">Settings</a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="index.html">kernel</a>::<wbr><a class="trait" href="#">Platform</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../src/kernel/lib.rs.html#42-91">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub trait Platform: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a> + 'static {
    type <a href="#associatedtype.PageTableSize" class="associatedtype">PageTableSize</a>: <a class="trait" href="../hal/memory/trait.FrameSize.html" title="trait hal::memory::FrameSize">FrameSize</a>;
    type <a href="#associatedtype.PageTable" class="associatedtype">PageTable</a>: <a class="trait" href="../hal/memory/paging/trait.PageTable.html" title="trait hal::memory::paging::PageTable">PageTable</a>&lt;Self::<a class="associatedtype" href="trait.Platform.html#associatedtype.PageTableSize" title="type kernel::Platform::PageTableSize">PageTableSize</a>&gt; + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a>;
    type <a href="#associatedtype.TaskContext" class="associatedtype">TaskContext</a>;

    // Required methods
    fn <a href="#tymethod.kernel_page_table" class="fn">kernel_page_table</a>(&amp;mut self) -&gt; &amp;mut Self::<a class="associatedtype" href="trait.Platform.html#associatedtype.PageTable" title="type kernel::Platform::PageTable">PageTable</a>;
<span class="item-spacer"></span>    unsafe fn <a href="#tymethod.initialize_task_stacks" class="fn">initialize_task_stacks</a>(
        kernel_stack: &amp;<a class="struct" href="memory/struct.Stack.html" title="struct kernel::memory::Stack">Stack</a>,
        user_stack: &amp;<a class="struct" href="memory/struct.Stack.html" title="struct kernel::memory::Stack">Stack</a>,
        task_entry_point: <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>
    ) -&gt; (<a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>, <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>);
<span class="item-spacer"></span>    fn <a href="#tymethod.new_task_context" class="fn">new_task_context</a>(
        kernel_stack_pointer: <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>,
        user_stack_pointer: <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>,
        task_entry_point: <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>
    ) -&gt; Self::<a class="associatedtype" href="trait.Platform.html#associatedtype.TaskContext" title="type kernel::Platform::TaskContext">TaskContext</a>;
<span class="item-spacer"></span>    unsafe fn <a href="#tymethod.switch_user_stack_pointer" class="fn">switch_user_stack_pointer</a>(new_user_stack_pointer: <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>) -&gt; <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>;
<span class="item-spacer"></span>    unsafe fn <a href="#tymethod.context_switch" class="fn">context_switch</a>(
        current_kernel_stack_pointer: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.pointer.html">*mut </a><a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>,
        new_kernel_stack_pointer: <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>,
        from_context: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.pointer.html">*mut </a>Self::<a class="associatedtype" href="trait.Platform.html#associatedtype.TaskContext" title="type kernel::Platform::TaskContext">TaskContext</a>,
        to_context: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.pointer.html">*const </a>Self::<a class="associatedtype" href="trait.Platform.html#associatedtype.TaskContext" title="type kernel::Platform::TaskContext">TaskContext</a>
    );
<span class="item-spacer"></span>    unsafe fn <a href="#tymethod.drop_into_userspace" class="fn">drop_into_userspace</a>(
        context: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.pointer.html">*const </a>Self::<a class="associatedtype" href="trait.Platform.html#associatedtype.TaskContext" title="type kernel::Platform::TaskContext">TaskContext</a>,
        kernel_stack_pointer: <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>,
        user_stack_pointer: <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>
    ) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.never.html">!</a>;
}</code></pre><h2 id="required-associated-types" class="section-header">Required Associated Types<a href="#required-associated-types" class="anchor">§</a></h2><div class="methods"><section id="associatedtype.PageTableSize" class="method"><a class="src rightside" href="../src/kernel/lib.rs.html#43">source</a><h4 class="code-header">type <a href="#associatedtype.PageTableSize" class="associatedtype">PageTableSize</a>: <a class="trait" href="../hal/memory/trait.FrameSize.html" title="trait hal::memory::FrameSize">FrameSize</a></h4></section><section id="associatedtype.PageTable" class="method"><a class="src rightside" href="../src/kernel/lib.rs.html#44">source</a><h4 class="code-header">type <a href="#associatedtype.PageTable" class="associatedtype">PageTable</a>: <a class="trait" href="../hal/memory/paging/trait.PageTable.html" title="trait hal::memory::paging::PageTable">PageTable</a>&lt;Self::<a class="associatedtype" href="trait.Platform.html#associatedtype.PageTableSize" title="type kernel::Platform::PageTableSize">PageTableSize</a>&gt; + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a></h4></section><section id="associatedtype.TaskContext" class="method"><a class="src rightside" href="../src/kernel/lib.rs.html#45">source</a><h4 class="code-header">type <a href="#associatedtype.TaskContext" class="associatedtype">TaskContext</a></h4></section></div><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><section id="tymethod.kernel_page_table" class="method"><a class="src rightside" href="../src/kernel/lib.rs.html#47">source</a><h4 class="code-header">fn <a href="#tymethod.kernel_page_table" class="fn">kernel_page_table</a>(&amp;mut self) -&gt; &amp;mut Self::<a class="associatedtype" href="trait.Platform.html#associatedtype.PageTable" title="type kernel::Platform::PageTable">PageTable</a></h4></section><details class="toggle method-toggle" open><summary><section id="tymethod.initialize_task_stacks" class="method"><a class="src rightside" href="../src/kernel/lib.rs.html#54-58">source</a><h4 class="code-header">unsafe fn <a href="#tymethod.initialize_task_stacks" class="fn">initialize_task_stacks</a>(
    kernel_stack: &amp;<a class="struct" href="memory/struct.Stack.html" title="struct kernel::memory::Stack">Stack</a>,
    user_stack: &amp;<a class="struct" href="memory/struct.Stack.html" title="struct kernel::memory::Stack">Stack</a>,
    task_entry_point: <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>
) -&gt; (<a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>, <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>)</h4></section></summary><div class="docblock"><p>Often, the platform will need to put stuff on either the kernel or the user stack before a task is run for
the first time. <code>task_entry_point</code> is the virtual address that should be jumped to in usermode when the
task is run for the first time.</p>
<p>The return value is of the form <code>(kernel_stack_pointer, user_stack_pointer)</code>.</p>
</div></details><section id="tymethod.new_task_context" class="method"><a class="src rightside" href="../src/kernel/lib.rs.html#60-64">source</a><h4 class="code-header">fn <a href="#tymethod.new_task_context" class="fn">new_task_context</a>(
    kernel_stack_pointer: <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>,
    user_stack_pointer: <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>,
    task_entry_point: <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>
) -&gt; Self::<a class="associatedtype" href="trait.Platform.html#associatedtype.TaskContext" title="type kernel::Platform::TaskContext">TaskContext</a></h4></section><section id="tymethod.switch_user_stack_pointer" class="method"><a class="src rightside" href="../src/kernel/lib.rs.html#66">source</a><h4 class="code-header">unsafe fn <a href="#tymethod.switch_user_stack_pointer" class="fn">switch_user_stack_pointer</a>(new_user_stack_pointer: <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>) -&gt; <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a></h4></section><details class="toggle method-toggle" open><summary><section id="tymethod.context_switch" class="method"><a class="src rightside" href="../src/kernel/lib.rs.html#77-82">source</a><h4 class="code-header">unsafe fn <a href="#tymethod.context_switch" class="fn">context_switch</a>(
    current_kernel_stack_pointer: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.pointer.html">*mut </a><a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>,
    new_kernel_stack_pointer: <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>,
    from_context: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.pointer.html">*mut </a>Self::<a class="associatedtype" href="trait.Platform.html#associatedtype.TaskContext" title="type kernel::Platform::TaskContext">TaskContext</a>,
    to_context: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.pointer.html">*const </a>Self::<a class="associatedtype" href="trait.Platform.html#associatedtype.TaskContext" title="type kernel::Platform::TaskContext">TaskContext</a>
)</h4></section></summary><div class="docblock"><p>Do the final part of a context switch: save all the state that needs to be for the
currently running task, switch to the new kernel stack, and restore the state of the next
task.</p>
<p>This function takes both kernel stacks for the current and new tasks, and also the
platform-specific task context held in the task. This is because we use various methods of
doing context switches on different platforms, according to the easiest / most performant
for the architecture. A pointer to the current kernel stack is provided so that it can be
updated if state is pushed onto it.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.drop_into_userspace" class="method"><a class="src rightside" href="../src/kernel/lib.rs.html#86-90">source</a><h4 class="code-header">unsafe fn <a href="#tymethod.drop_into_userspace" class="fn">drop_into_userspace</a>(
    context: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.pointer.html">*const </a>Self::<a class="associatedtype" href="trait.Platform.html#associatedtype.TaskContext" title="type kernel::Platform::TaskContext">TaskContext</a>,
    kernel_stack_pointer: <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>,
    user_stack_pointer: <a class="struct" href="../hal/memory/virtual_address/struct.VAddr.html" title="struct hal::memory::virtual_address::VAddr">VAddr</a>
) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.never.html">!</a></h4></section></summary><div class="docblock"><p>Do the actual drop into usermode. This assumes that the task’s page tables have already been installed,
and that an initial frame has been put into the task’s kernel stack that this will use to enter userspace.</p>
</div></details></div><h2 id="object-safety" class="section-header">Object Safety<a href="#object-safety" class="anchor">§</a></h2><div class="object-safety-info">This trait is <b>not</b> <a href="https://doc.rust-lang.org/nightly/reference/items/traits.html#object-safety">object safe</a>.</div><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"></div><script src="../trait.impl/kernel/trait.Platform.js" async></script></section></div></main></body></html>